name: Google_Remote_Desktop_RDP

on: 
  workflow_dispatch: # Permite iniciar o RDP manualmente

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Preparando Ambiente (Download de Dependências)
        run: |
          sudo apt update
          wget dl.google.com
          # INSTALACAO CORRIGIDA: Usa dpkg para instalar o pacote .deb
          sudo dpkg -i chrome-remote-desktop_current_amd64.deb
          # CORRECAO DE ERRO: Usa apt install -f para corrigir dependencias automaticamente (exit code 100)
          sudo apt install -f --assume-yes
          # Instala os ambientes de desktop necessarios
          sudo apt install --assume-yes xfce4 desktop-base xfce4-terminal xscreensaver
          
      - name: Configurando Desktop e Usuário
        run: |
          # Define o XFCE como interface padrao
          sudo bash -c 'echo "exec /etc/X11/Xsession /usr/bin/xfce4-session" > /etc/chrome-remote-desktop-session'
          sudo apt install nautilus expect -y

      - name: Iniciando Google Remote Desktop
        run: |
          # EXECUCAO CORRIGIDA: Executa o secret CRP diretamente como um comando shell (evita exit code 2)
          ${{ secrets.CRP }} --pin=123456
          
      - name: Manter Ativo
        run: |
          # Mantem o workflow rodando para a conexao nao cair imediatamente
          sleep 21600 
